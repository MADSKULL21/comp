var a=Object.defineProperty;var d=(r,e,t)=>e in r?a(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>d(r,typeof e!="symbol"?e+"":e,t);import{g as h,s as f}from"./C1nXBIR4.js";import{I as l}from"./CG1L1sNd.js";import{a as u}from"./CJIe8Wgg.js";import{T as p,w as n}from"./BX4Dnpro.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};r.SENTRY_RELEASE={id:"22f298fe9ac7c9892685cfa634f1dd18037bb1ae"}}catch{}})();try{(function(){var r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new r.Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="e5d428fd-aef7-4c7c-a42b-43bdcdcb3467",r._sentryDebugIdIdentifier="sentry-dbid-e5d428fd-aef7-4c7c-a42b-43bdcdcb3467")})()}catch{}function y(r){h()&&f({id:r.id,email:r.email,username:r.name})}const U=new l("UserService");class _{constructor(e){o(this,"user",n(void 0,e=>{this.fetchUser().then(t=>{this.error.set(void 0),e(t)}).catch(t=>{this.error.set(t)})}));o(this,"error",n());o(this,"patchStackCache",new Map);this.httpClient=e,e||console.error("[UserService] HttpClient was not provided in constructor"),e.authenticationAvailable.subscribe(t=>{t&&p(this.user)===void 0?this.fetchUser().then(s=>{this.error.set(void 0),this.user.set(s)}).catch(s=>{this.error.set(s)}):t||this.user.set(void 0)})}async fetchUser(){const e=await this.httpClient.get("/api/user");return y(e),e}async refreshUser(){try{const e=await this.fetchUser();this.user.set(e),this.error.set(void 0)}catch(e){this.error.set(e)}}clearUser(){this.user.set(void 0)}async deleteAccount(){try{await this.httpClient.delete("/api/user")}catch(e){this.error.set(e),console.error("Failed to delete account:",e)}}async updateUser(e){const t=new FormData;return e.name&&t.append("name",e.name),e.picture&&t.append("avatar",e.picture),e.website!==void 0&&t.append("website",e.website),e.twitter!==void 0&&t.append("twitter",e.twitter),e.bluesky!==void 0&&t.append("bluesky",e.bluesky),e.timezone!==void 0&&t.append("timezone",e.timezone),e.location!==void 0&&t.append("location",e.location),e.emailShare!==void 0&&t.append("email_share",e.emailShare.toString()),e.readme!==void 0&&t.append("readme",e.readme),e.generate_ssh_token!==void 0&&t.append("generate_ssh_token",e.generate_ssh_token.toString()),await this.httpClient.put("user.json",{body:t,headers:{"Content-Type":void 0}})}getPatchStacks(e){if(!this.patchStackCache.has(e)){const t=n({status:"loading",ownerSlug:e},s=>{this.fetchPatchStacks(e).then(i=>{s({status:"found",ownerSlug:e,value:i})}).catch(i=>{var c;((c=i.response)==null?void 0:c.status)===404?s({status:"not-found",ownerSlug:e}):s({status:"error",ownerSlug:e,error:i.message||"Unknown error occurred"})})});this.patchStackCache.set(e,t)}return this.patchStackCache.get(e)}async fetchPatchStacks(e){if(!this.httpClient)return console.error("[UserService] HttpClient is undefined"),[];const t=`user/${e}/patch_stacks`;try{return(await this.httpClient.get(t)).map(u)}catch(s){if(console.error(`[UserService] Error with endpoint ${t}:`,s),s.response&&s.response.status!==404)throw s;return[]}}async recentProjects(e){try{return await this.httpClient.get(`/api/user/${e}/projects?limit=6`)}catch(t){return console.error("Failed to fetch recent projects:",t),[]}}async refreshAccessToken(){try{await this.httpClient.post("/api/user/refresh_access_token")}catch(e){console.error("Failed to refresh access token:",e)}}}export{U,_ as a};
//# sourceMappingURL=D69wT3hA.js.map
