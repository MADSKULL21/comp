var h=Object.defineProperty;var d=(e,t,a)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var c=(e,t,a)=>d(e,typeof t!="symbol"?t+"":t,a);import{a as u}from"./CJIe8Wgg.js";import{I as p,P as f,a as g,o as s,p as l,e as z}from"./BJQ2FMEW.js";import{I as O}from"./CG1L1sNd.js";import{w as y}from"./BX4Dnpro.js";import{a as r,b}from"./COwXhGw8.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"22f298fe9ac7c9892685cfa634f1dd18037bb1ae"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a061e0a5-30ab-4377-83fe-829097186f2b",e._sentryDebugIdIdentifier="sentry-dbid-a061e0a5-30ab-4377-83fe-829097186f2b")})()}catch{}const _=new O("OrganizationService");class S{constructor(t,a){c(this,"httpClient");c(this,"appDispatch");c(this,"organizationListingInterests",new p(f));c(this,"orgnaizationInterests",new p(g));c(this,"patchStackCache",new Map);this.httpClient=t,this.appDispatch=a}getOrganizationListingInterest(){return this.organizationListingInterests.findOrCreateSubscribable(void 0,async()=>{const a=(await this.httpClient.get("organization")).map(i=>({status:"found",id:i.slug,value:r(i)}));this.appDispatch.dispatch(s.upsertMany(a))}).createInterest()}getOrganizationWithDetailsInterest(t){return this.orgnaizationInterests.findOrCreateSubscribable({slug:t},async()=>{this.appDispatch.dispatch(s.addOne({status:"loading",id:t}));try{const a=await this.httpClient.get(`organization/${t}`),i=a.projects.map(n=>({status:"found",id:n.repository_id,value:b(n)}));this.appDispatch.dispatch(l.upsertMany(i)),this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:r(a)}))}catch(a){this.appDispatch.dispatch(s.addOne(z(a,t)))}}).createInterest()}async createOrganization(t,a,i){const n=await this.httpClient.post("organization",{body:{slug:t,name:a,description:i}}),o=r(n);return this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:o})),o}async joinOrganization(t,a){const i=await this.httpClient.post(`organization/${t}/join`,{body:{invite_code:a}}),n=r(i);return this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:n})),n}getPatchStacks(t){if(!this.patchStackCache.has(t)){const a=y({status:"loading",ownerSlug:t},i=>{this.fetchPatchStacks(t).then(n=>{i({status:"found",ownerSlug:t,value:n})}).catch(n=>{var o;((o=n.response)==null?void 0:o.status)===404?i({status:"not-found",ownerSlug:t}):i({status:"error",ownerSlug:t,error:n.message||"Unknown error occurred"})})});this.patchStackCache.set(t,a)}return this.patchStackCache.get(t)}async fetchPatchStacks(t){const a=`organization/${t}/patch_stacks`;try{return(await this.httpClient.get(a)).map(u)}catch(i){if(console.error(`[OrganizationService] Error with endpoint ${a}:`,i),i.response&&i.response.status!==404)throw i}return console.warn("[OrganizationService] All endpoints failed, returning empty array"),[]}clearPatchStackCache(t){t?this.patchStackCache.delete(t):this.patchStackCache.clear()}async removeUser(t,a){const i=await this.httpClient.post(`organization/${t}/remove?login=${a}`,{}),n=r(i);return this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:n})),n}async resetInviteCode(t){const a=await this.httpClient.post(`organization/${t}/reset_invite_code`,{}),i=r(a);return this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:i})),i}async changeUserRole(t,a,i){const n=await this.httpClient.put(`organization/${t}/${a}?role=${i}`,{}),o=r(n);return this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:o})),o}async getOrganizationBySlug(t){try{const a=await this.httpClient.get(`organization/${t}`),i=r(a);return this.appDispatch.dispatch(s.upsertOne({status:"found",id:t,value:i})),i}catch(a){if(a.response&&a.response.status===404)return;throw a}}async updateOrganization(t,a){const i=await this.httpClient.put(`organization/${t}`,{body:{name:a.name,new_slug:a.new_slug,description:a.description}}),n=r(i),o=a.new_slug||t;return this.appDispatch.dispatch(s.upsertOne({status:"found",id:o,value:n})),o!==t&&this.appDispatch.dispatch(s.removeOne(t)),n}}export{_ as O,S as a};
//# sourceMappingURL=vdW0E3mk.js.map
