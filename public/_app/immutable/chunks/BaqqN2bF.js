var C=Object.defineProperty;var w=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var u=(t,e,s)=>w(t,typeof e!="symbol"?e+"":e,s);import{c as d,d as h,i as O,B as S,e as v,a as l,f as I,p as B}from"./CJIe8Wgg.js";import{e as A,p as o,f as p,g as P,h as m}from"./BegIwIKf.js";import{I as _,b as $,a as g,e as y}from"./BJQ2FMEW.js";import{I as b}from"./CG1L1sNd.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"22f298fe9ac7c9892685cfa634f1dd18037bb1ae"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="cc10e1a8-af7b-4ff1-8da0-b085cefe2c76",t._sentryDebugIdIdentifier="sentry-dbid-cc10e1a8-af7b-4ff1-8da0-b085cefe2c76")})()}catch{}function j(t){return{reaction:t.reaction,users:t.users.map(d)}}function L(t){return{uuid:t.uuid,user:d(t.user),outdated:t.outdated,issue:t.issue,resolved:t.resolved,threadId:t.thread_id??void 0,comment:t.comment,mentions:t.mentions.map(d)}}function F(t,e){return e===void 0?t:`${t}:${e}`}function D(t){return{comment:t.comment,mentions:t.mentions.map(d),inReplyTo:t.in_reply_to?L(t.in_reply_to):void 0,emojiReactions:t.emoji_reactions.map(j),diffPatchArray:t.diff_patch_array??void 0,diffPath:t.diff_path??void 0,diffSha:t.diff_sha??void 0,issue:t.issue,outdated:t.outdated,resolved:t.resolved,uuid:t.uuid,createdAt:t.created_at,updatedAt:t.updated_at,threadId:t.thread_id??void 0,user:d(t.user)}}function J(t){return{branch_id:t.branchId,chat:t.chat,displayable_text:t.displayableText,change_id:t.changeId,thread_id:t.threadId,issue:t.issue,diff_path:t.diffPath,diff_sha:t.diffSha,range:t.range,in_reply_to:t.inReplyTo}}function Q(t){return{chat_uuid:t.messageUuid,resolved:t.resolved,reaction:t.reaction}}function f(t){return typeof t=="object"&&t!==null&&typeof t.uuid=="string"&&typeof t.event_type=="string"&&(O(t.user)||t.user===null)}function R(t){return f(t)&&t.event_type==="chat"}function k(t){return f(t)&&t.event_type==="chat_reaction"&&typeof t.data=="object"&&t.data!==null&&typeof t.data.reaction=="string"}function N(t){return f(t)&&t.event_type==="chat_reply"&&typeof t.data=="object"&&t.data!==null&&typeof t.data.in_reply_to=="string"}function U(t){return f(t)&&t.event_type==="patch_version"}function x(t){return f(t)&&t.event_type==="patch_status"}function G(t){return f(t)&&t.event_type==="issue_status"}function V(t){return R(t)||k(t)||N(t)||U(t)||x(t)||G(t)}function K(t){return{status:t.status,message:t.message??void 0}}function H(t){return{uuid:t.uuid,user:t.user?d(t.user):void 0,outdated:t.outdated,issue:t.issue,resolved:t.resolved,threadId:t.thread_id??void 0,comment:t.comment,diffSha:t.diffSha??void 0,range:t.range??void 0,diffPath:t.diff_path??void 0,diffPatchArray:t.diff_patch_array??void 0,createdAt:t.created_at,updatedAt:t.updated_at}}function Z(t){switch(t.event_type){case"chat":return t.object?{eventType:t.event_type,uuid:t.uuid,user:t.user?d(t.user):void 0,data:t.data,object:D(t.object),createdAt:t.created_at,updatedAt:t.updated_at}:null;case"chat_reaction":return{eventType:t.event_type,uuid:t.uuid,user:t.user?d(t.user):void 0,data:{reaction:t.data.reaction},object:D(t.object),createdAt:t.created_at,updatedAt:t.updated_at};case"chat_reply":return{eventType:t.event_type,uuid:t.uuid,user:t.user?d(t.user):void 0,data:{inReplyTo:t.data.in_reply_to},object:D(t.object),createdAt:t.created_at,updatedAt:t.updated_at};case"patch_version":return t.object.version===1?null:{eventType:t.event_type,uuid:t.uuid,user:t.user?d(t.user):void 0,data:t.data,object:h(t.object),createdAt:t.created_at,updatedAt:t.updated_at};case"patch_status":return{eventType:t.event_type,uuid:t.uuid,user:t.user?d(t.user):void 0,data:K(t.data),object:h(t.object),createdAt:t.created_at,updatedAt:t.updated_at};case"issue_status":return{eventType:t.event_type,uuid:t.uuid,user:t.user?d(t.user):void 0,data:t.data,object:H(t.object),createdAt:t.created_at,updatedAt:t.updated_at}}}function M(t,e){return`${t}:${e}`}const tt=new b("BranchService");class et{constructor(e,s){u(this,"httpClient");u(this,"appDispatch");u(this,"branchesInterests",new _($));u(this,"branchInterests",new _(g));this.httpClient=e,this.appDispatch=s}getBranchesInterest(e,s,n=S.All){return this.branchesInterests.findOrCreateSubscribable({ownerSlug:e,projectSlug:s,branchStatus:n},async()=>{this.appDispatch.dispatch(A.addOne({id:v(e,s,n),status:"loading"}));try{const a=await this.httpClient.get(`patch_stack/${e}/${s}?status=${n}`),c=a.map(r=>({status:"found",id:r.uuid,value:l(r)})),i=a.flatMap(r=>r.patches).map(r=>r?{status:"found",id:r.change_id,value:h(r)}:{status:"not-found",id:""});this.appDispatch.dispatch(o.upsertMany(i)),this.appDispatch.dispatch(p.upsertMany(c)),this.appDispatch.dispatch(A.upsertOne({id:v(e,s,n),status:"found",value:a.map(r=>r.uuid)}))}catch(a){this.appDispatch.dispatch(A.addOne(y(a,v(e,s,n))))}}).createInterest()}async getBranch(e){var s;try{const n=await this.httpClient.get(`patch_stack/${e}`),a={status:"found",id:n.uuid,value:l(n)},c=(s=n.patches)==null?void 0:s.map(i=>({status:"found",id:i.change_id,value:h(i)}));return this.appDispatch.dispatch(p.upsertOne(a)),c&&this.appDispatch.dispatch(o.upsertMany(c)),l(n)}catch{}}getBranchInterest(e){return this.branchInterests.findOrCreateSubscribable({uuid:e},async()=>{var s;this.appDispatch.dispatch(p.addOne({status:"loading",id:e}));try{const n=await this.httpClient.get(`patch_stack/${e}`),a={status:"found",id:n.uuid,value:l(n)},c=(s=n.patches)==null?void 0:s.map(i=>({status:"found",id:i.change_id,value:h(i)}));this.appDispatch.dispatch(p.upsertOne(a)),c&&this.appDispatch.dispatch(o.upsertMany(c))}catch(n){this.appDispatch.dispatch(p.addOne(y(n,e)))}}).createInterest()}async refreshBranch(e){await this.branchInterests.invalidate({uuid:e})}async updateBranch(e,s){var i;const n=await this.httpClient.patch(`patch_stack/${e}`,{body:{status:s.status,title:s.title,description:s.description,forge_url:s.forgeUrl,forge_description:s.forgeDescription}}),a=l(n),c=(i=n.patches)==null?void 0:i.map(r=>({status:"found",id:r.change_id,value:h(r)}));return this.appDispatch.dispatch(p.upsertOne({status:"found",id:a.uuid,value:a})),this.appDispatch.dispatch(o.upsertMany(c??[])),a}}const st=new b("PatchCommitService");class nt{constructor(e,s){u(this,"httpClient");u(this,"appDispatch");u(this,"patchInterests",new _(g));this.httpClient=e,this.appDispatch=s}getPatchWithSectionsInterest(e,s){return this.patchInterests.findOrCreateSubscribable({changeId:s},async()=>{this.appDispatch.dispatch(o.addOne({status:"loading",id:s}));try{const n=await this.httpClient.get(`patch_stack/${e}/patch/${s}`),a=h(n);if(n.sections){const c=n.sections.map(I);this.appDispatch.dispatch(P(c))}this.appDispatch.dispatch(o.upsertOne({status:"found",id:s,value:a}))}catch(n){this.appDispatch.dispatch(o.addOne(y(n,s)))}}).createInterest()}async refreshPatchWithSections(e){await this.patchInterests.invalidate({changeId:e})}async updatePatch(e,s,n){const a=await this.httpClient.patch(`patch_stack/${e}/patch/${s}`,{body:{sign_off:n.signOff,section_order:n.sectionOrder,message:n.message}}),c=h(a);if(this.appDispatch.dispatch(o.upsertOne({status:"found",id:s,value:c})),a.sections){const i=a.sections.map(I);this.appDispatch.dispatch(P(i))}return c}}const at=new b("PatchIdableService");class ct{constructor(e,s){u(this,"httpClient");u(this,"appDispatch");u(this,"patchIntrests",new _);this.httpClient=e,this.appDispatch=s}getPatchIdableInterest({branchUuid:e,changeId:s,oldVersion:n,newVersion:a}){return this.patchIntrests.findOrCreateSubscribable({branchUuid:e,changeId:s,oldVersion:n,newVersion:a},async()=>{const c=B({branchUuid:e,changeId:s,oldVersion:n,newVersion:a});this.appDispatch.dispatch(m.addOne({status:"loading",id:c}));try{let i=`?version_new=${a}`;n&&(i+=`&version_old=${n}`);const r=await this.httpClient.get(`diff/${e}/change/${s}${i}`),E=h(r);if(r.sections){const T=r.sections.map(I);this.appDispatch.dispatch(P(T))}this.appDispatch.dispatch(m.upsertOne({status:"found",id:c,value:E}))}catch(i){this.appDispatch.dispatch(m.addOne(y(i,c)))}}).createInterest()}}const it=new b("ExternalLinkService");export{tt as B,it as E,nt as P,et as a,ct as b,st as c,at as d,F as e,D as f,Q as g,M as h,Z as i,V as j,J as t};
//# sourceMappingURL=BaqqN2bF.js.map
