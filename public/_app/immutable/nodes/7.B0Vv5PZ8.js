import{w as pt}from"../chunks/CoLexm2l.js";import{a as ft,s as gt}from"../chunks/CPkq-MRm.js";import{p as xe,Q as ue,a8 as Ae,V as Ge,b as M,g as e,u as n,a as be,ap as ht,c as S,r as C,f as h,n as A,t as se,$ as $e,a0 as De,s as f}from"../chunks/BX4Dnpro.js";import{f as U,a as s,c as O,b as _t,t as F,s as pe}from"../chunks/DS607QHn.js";import{a as yt}from"../chunks/CgPwrCPE.js";import{i as w}from"../chunks/DrMRszh9.js";import{d as Be,k as ze,a as He,e as xt,i as bt,s as We}from"../chunks/Dbls2O6t.js";import{g as kt}from"../chunks/6BIzYspF.js";import{T as wt,a as St}from"../chunks/CZwNO8ya.js";import{i as oe}from"../chunks/CG1L1sNd.js";import{g as Ct,a as Pt,b as At,c as Et,d as Ye,I as It,F as le,M as Bt,e as Rt}from"../chunks/Dwaw39Uc.js";import{L as qe}from"../chunks/C5U-6dPW.js";import{i as Y,g as Ve,m as Re,h as Ee,j as Tt}from"../chunks/BJQ2FMEW.js";import{g as jt,B as ge}from"../chunks/CJIe8Wgg.js";import{W as Ke}from"../chunks/CGrgT5Uy.js";import"../chunks/RIzBnn02.js";import{l as Ut,P as Oe,R as Lt,F as Ft}from"../chunks/CmUa9IOX.js";import{U as $t}from"../chunks/D69wT3hA.js";import{u as Dt}from"../chunks/pHgJ-cmp.js";import{B as fe,b as Wt,c as Me}from"../chunks/z-ijcZsT.js";import{C as Vt,A as Ot}from"../chunks/CzBRMrWk.js";import{B as Mt}from"../chunks/BaqqN2bF.js";import{L as Nt,U as Gt}from"../chunks/CWb7VjCc.js";import{A as zt}from"../chunks/BegIwIKf.js";import{A as Ie}from"../chunks/CqK7S2kR.js";import{c as Ht}from"../chunks/CU5A-fSP.js";import{L as Yt,M as qt}from"../chunks/DAKYNFB-.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};u.SENTRY_RELEASE={id:"22f298fe9ac7c9892685cfa634f1dd18037bb1ae"}}catch{}})();try{(function(){var u=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new u.Error().stack;a&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[a]="9ceecbf3-f3ce-4ab6-baa4-7e0ea0b90afe",u._sentryDebugIdIdentifier="sentry-dbid-9ceecbf3-f3ce-4ab6-baa4-7e0ea0b90afe")})()}catch{}const Ne=async({params:u})=>({ownerSlug:u.ownerSlug,projectSlug:u.projectSlug,branchId:u.branchId}),Kt=Ne?pt(Ne):void 0,Vr=Object.freeze(Object.defineProperty({__proto__:null,load:Kt},Symbol.toStringTag,{value:"Module"}));function Qt(u,a){xe(a,!0),Be.extend(ze);const E=oe(Ke),N=n(()=>Ye(a.branchUuid)),g=n(()=>Et(a.branchUuid,a.changeId));let q=ue(Ae([])),G=ue(Ae([])),K=ue(Ae([]));Ge(()=>{(async()=>(M(q,Y(e(g).current)?await Ct(e(g).current.value):[],!0),M(G,Y(e(g).current)?await Pt(e(g).current.value):[],!0),M(K,Y(e(g).current)?await At(e(g).current.value):[],!0)))()});const c=n(()=>Re(Ve([e(g).current,e(N).current]),([_,Z])=>{var re;const ee=((re=Z.patches)==null?void 0:re.length)??1,te=_.position??0;return ee-te}));{const _=(ee,te)=>{var re=n(()=>ht(te==null?void 0:te(),2));let y=()=>e(re)[0],d=()=>e(re)[1];{let ke=n(()=>E.projectReviewBranchCommitPath({...a.params,changeId:y().changeId})),we=n(()=>{var I;return[{key:"position",value:`${e(c)}/${((I=d().patches)==null?void 0:I.length)??1}`},{key:"status",value:jt(y())},{key:"version",value:`v${y().version}`,tooltip:"Patch Version"},{key:"title",value:y().title,tooltip:y().title},{key:"changes",value:{additions:y().statistics.lines-y().statistics.deletions,deletions:y().statistics.deletions}},{key:"date",value:y().updatedAt,tooltip:y().updatedAt},{key:"avatars",value:e(q)},{key:"reviewers",value:{approvers:e(G),rejectors:e(K)}},{key:"comments",value:y().commentCount,tooltip:"Comments"}]}),ce=n(()=>{var I;return e(c)===((I=d().patches)==null?void 0:I.length)}),Se=n(()=>e(c)===1);wt(ee,{get href(){return e(ke)},get columns(){return e(we)},get isTopEntry(){return e(ce)},get separatedBottom(){return e(Se)}})}};let Z=n(()=>Ve([e(g).current,e(N).current]));qe(u,{get loadable(){return e(Z)},children:_,$$slots:{default:!0}})}be()}var Jt=U('<table class="commits-table"><!></table>');const Xt={hash:"svelte-3kpd",code:""};function Zt(u,a){xe(a,!0),He(u,Xt);var E=Jt(),N=S(E);St(N,{headColumns:[{key:"position",value:""},{key:"status",value:"Status"},{key:"version",value:"Ver."},{key:"string",value:"Name"},{key:"changes",value:"Changes"},{key:"date",value:"Updated"},{key:"avatars",value:"Authors"},{key:"reviewers",value:"Reviewers"},{key:"comments",value:""}],body:q=>{var G=O(),K=h(G);xt(K,17,()=>a.branch.patchCommitIds||[],bt,(c,_,Z)=>{{let ee=n(()=>Z===a.branch.patchCommitIds.length-1);Qt(c,{get changeId(){return e(_)},get params(){return a.data},get branchUuid(){return a.branch.uuid},get last(){return e(ee)}})}}),s(q,G)}}),C(E),s(u,E),be()}function er(u,a){xe(a,!0);const E=n(()=>a.branch.patches),N=n(()=>{var c;return(c=e(E))==null?void 0:c.some(_=>_.reviewAll.rejected.length>0)}),g=n(()=>{var c;return(c=e(E))==null?void 0:c.some(_=>_.reviewAll.signedOff.length>0)}),q=n(()=>{var c;return!((c=e(E))!=null&&c.some(_=>_.reviewAll.signedOff.length===0))}),G=n(()=>{var c;return((c=e(E))==null?void 0:c.some(_=>_.commentCount>0))??!1}),K=n(()=>a.branch.status===ge.Closed?"closed":a.branch.status===ge.Loading?"loading":e(N)?"changes-requested":e(q)?"approved":e(g)||e(G)&&!e(g)&&!e(N)?"in-discussion":"unreviewed");Vt(u,{get status(){return e(K)}}),be()}var tr=U('<meta property="og:title"/> <meta property="og:description" content="GitButler code review"/>',1),rr=U('<meta property="og:title"/> <meta property="og:description" content="GitButler code review"/>',1),ar=U('<div class="error-container"><h2 class="text-15 text-body text-bold">Error loading project data</h2> <p class="text-13 text-body"> </p></div>'),sr=U('<p class="text-15 text-bold"> </p>'),or=U("<!> <!> <!> <!> <!> <!>",1),nr=U('<div class="summary-wrapper svelte-1xxu2ks"><!></div> <div class="summary-actions"><!> <!></div>',1),ir=U("<div><!></div>"),lr=U('<div class="text-13 summary-text svelte-1xxu2ks"><!></div> <!>',1),ur=U(`<p class="text-12 text-body clr-text-2"><em>Summaries provide context on the branch's purpose and helps team members
											understand it's changes.</em></p> <!>`,1),cr=U('<div class="summary-placeholder svelte-1xxu2ks"><p class="text-13 clr-text-2">No summary provided.</p> <!></div>'),dr=U('<div class="layout svelte-1xxu2ks"><div class="information svelte-1xxu2ks"><div class="heading svelte-1xxu2ks"><!> <div class="actions"><!> <!> <!></div></div> <!> <div class="summary svelte-1xxu2ks"><!></div></div> <!></div>');const vr={hash:"svelte-1xxu2ks",code:`.layout.svelte-1xxu2ks {display:grid;grid-template-columns:6fr 10fr;gap:var(--layout-col-gap);}

	@media (max-width: 80rem) {.layout.svelte-1xxu2ks {display:flex;grid-template-columns:unset;flex-direction:column;}
		}.information.svelte-1xxu2ks {display:flex;flex-direction:column;padding-right:20px;gap:24px;}

	@media (max-width: 64rem) {.information.svelte-1xxu2ks {padding-right:0;}
		}.heading.svelte-1xxu2ks {display:flex;flex-direction:column;gap:16px;}.summary.svelte-1xxu2ks {display:flex;flex-direction:column;gap:16px;}.summary-text.svelte-1xxu2ks {padding:12px;border:1px solid #ddd;border-radius:9px;background-color:#fff;line-height:160%;}.summary-placeholder.svelte-1xxu2ks {display:flex;flex-direction:column;align-items:flex-start;gap:12px;}.summary-wrapper.svelte-1xxu2ks {flex-shrink:0;padding:6px;border:1px solid var(--clr-border-2);border-radius:var(--radius-m);background-color:var(--clr-bg-1);}`};function Or(u,a){xe(a,!0),He(u,vr);const[E,N]=ft(),g=()=>gt(e(re),"$user",E),q=(t,r=De)=>{var B=O(),z=h(B);{var x=i=>{fe(i,{style:"pop",icon:"play",onclick:()=>Je(r()),children:(b,Q)=>{A();var l=F("Start review");s(b,l)},$$slots:{default:!0}})};w(z,i=>{(r().stackSize||0)>0&&e(ke)===!1&&i(x)})}s(t,B)},G=["image/*","application/*","text/*","audio/*","video/*"];Be.extend(ze);const K=oe(Nt),c=oe(Mt),_=oe(zt),Z=oe(Ke),ee=oe($t),te=oe(Gt),re=n(()=>ee.user),y=n(()=>Ut(_,K,a.data.ownerSlug,a.data.projectSlug,a.data.branchId)),d=n(()=>{var t;return Re((t=e(y))==null?void 0:t.current,r=>Ye(r))}),ke=n(()=>{var t;return Re((t=e(d))==null?void 0:t.current,r=>r.contributors.some(B=>{var z,x,i;return((z=B.user)==null?void 0:z.id)!==void 0&&((x=B.user)==null?void 0:x.id)===((i=g())==null?void 0:i.id)}))}),we=n(()=>{var t;return Y((t=e(d))==null?void 0:t.current)?Rt(e(d).current.value):Promise.resolve([])});function ce(t){if(!Ee(t))return!1;const r=t.error.message||"";return t.error.name==="ApiError"&&r.includes("403")||r.includes("Forbidden")||r.includes("Access denied")||typeof r=="string"&&r.includes("403")}const Se=n(()=>{var t,r;return ce((t=e(y))==null?void 0:t.current)||ce((r=e(d))==null?void 0:r.current)}),I=n(()=>{var t,r;return Tt([(t=e(y))==null?void 0:t.current,(r=e(d))==null?void 0:r.current])}),Qe=n(()=>Ee(e(I)));function Je(t){var r;(((r=t.patchCommitIds)==null?void 0:r.length)||0)!==0&&kt(Z.projectReviewBranchCommitPath({...a.data,changeId:t.patchCommitIds.at(-1)}))}let de=ue(!1),Ce=ue(""),he=ue("");function Te(){var t;Y((t=e(d))==null?void 0:t.current)&&(M(Ce,structuredClone(e(d).current.value.description||""),!0),M(he,structuredClone(e(d).current.value.title||""),!0),M(de,!0))}function Xe(){confirm("Canceling will lose any changes made")&&M(de,!1)}async function Ze(){var t;if(Y((t=e(d))==null?void 0:t.current))try{await c.updateBranch(e(d).current.value.uuid,{title:e(he),description:e(Ce)}),Me.success("Updated review status")}finally{M(de,!1)}}async function je(t){var r;Y((r=e(d))==null?void 0:r.current)&&(await c.updateBranch(e(d).current.value.uuid,{status:t}),Me.success("Saved review summary"))}function et(){Ht(location.href)}function tt(t){const r=t.type.split("/")[0];return G.some(B=>B.startsWith(r))}async function rt(t){if(t===void 0)return[];const r=Array.from(t).filter(tt).map(async x=>{const i=await te.uploadFile(x);return{name:x.name,url:i.url,isImage:i.isImage}});return(await Promise.allSettled(r)).filter(x=>x.status==="fulfilled").map(x=>x.value)}Ge(()=>{var t,r;Y((t=e(d))==null?void 0:t.current)&&Dt((r=e(d).current.value)==null?void 0:r.reviewStatus)});var Ue=O();_t(t=>{var r=O(),B=h(r);{var z=i=>{var b=tr(),Q=h(b);A(2),se(()=>{var l,J;$e.title=(l=e(d).current.value)==null?void 0:l.title,We(Q,"content",`GitButler Review: ${((J=e(d).current.value)==null?void 0:J.title)??""}`)}),s(i,b)},x=i=>{var b=rr(),Q=h(b);A(2),se(()=>{$e.title=`${a.data.ownerSlug??""}/${a.data.projectSlug??""}`,We(Q,"content",`GitButler Review: ${a.data.ownerSlug??""}/${a.data.projectSlug??""}`)}),s(i,b)};w(B,i=>{var b;Y((b=e(d))==null?void 0:b.current)?i(z):i(x,!1)})}s(t,r)});var at=h(Ue);{var st=t=>{Oe(t,{})},ot=t=>{var r=O(),B=h(r);{var z=i=>{var b=O(),Q=h(b);{var l=$=>{Oe($,{})},J=$=>{var ne=O(),_e=h(ne);{var Pe=ve=>{var ie=ar(),me=f(S(ie),2),ye=S(me,!0);C(me),C(ie),se(()=>pe(ye,e(I).error.message)),s(ve,ie)};w(_e,ve=>{Ee(e(I))&&ve(Pe)},!0)}s($,ne)};w(Q,$=>{ce(e(I))?$(l):$(J,!1)})}s(i,b)},x=i=>{qe(i,{get loadable(){return e(I)},children:(Q,l=De)=>{var J=dr(),$=S(J),ne=S($),_e=S(ne);{var Pe=o=>{Wt(o,{get value(){return e(he)},set value(p){M(he,p,!0)}})},ve=o=>{var p=sr(),k=S(p,!0);C(p),se(()=>pe(k,l().title)),s(o,p)};w(_e,o=>{e(de)?o(Pe):o(ve,!1)})}var ie=f(_e,2),me=S(ie);fe(me,{icon:"copy-small",kind:"outline",onclick:et,children:(o,p)=>{A();var k=F("Share link");s(o,k)},$$slots:{default:!0}});var ye=f(me,2);q(ye,l);var nt=f(ye,2);{var it=o=>{Ie(o,{action:async()=>je(ge.Active),kind:"outline",children:(p,k)=>{A();var D=F("Re-open review");s(p,D)},$$slots:{default:!0}})},lt=o=>{Ie(o,{style:"danger",kind:"outline",action:async()=>je(ge.Closed),children:(p,k)=>{A();var D=F("Close review");s(p,D)},$$slots:{default:!0}})};w(nt,o=>{l().status===ge.Closed?o(it):o(lt,!1)})}C(ie),C(ne);var Le=f(ne,2);It(Le,{children:(o,p)=>{var k=or(),D=h(k);le(D,{label:"Status",children:(v,j)=>{er(v,{get branch(){return l()}})}});var ae=f(D,2);le(ae,{label:"Commits",children:(v,j)=>{var m=O(),V=h(m);{var X=H=>{Bt(H,{get branchUuid(){return l().uuid},get ownerSlug(){return a.data.ownerSlug},get projectSlug(){return a.data.projectSlug},horizontal:!0,get user(){return g()}})};w(V,H=>{g()&&H(X)})}s(v,m)}});var R=f(ae,2);{var W=v=>{le(v,{label:"PR",children:(j,m)=>{Yt(j,{get href(){return l().forgeUrl},children:(V,X)=>{A();var H=F();se(()=>pe(H,l().forgeDescription||"#unknown")),s(V,H)},$$slots:{default:!0}})}})};w(R,v=>{l().forgeUrl&&v(W)})}var P=f(R,2);le(P,{label:"Authors",children:(v,j)=>{var m=O(),V=h(m);yt(V,()=>e(we),null,(X,H)=>{Ot(X,{get avatars(){return e(H)}})}),s(v,m)}});var T=f(P,2);le(T,{label:"Updated",children:(v,j)=>{A();var m=F();se(V=>pe(m,V),[()=>Be(l().updatedAt).fromNow()]),s(v,m)}});var L=f(T,2);le(L,{label:"Version",children:(v,j)=>{A();var m=F();se(()=>pe(m,l().version)),s(v,m)}}),s(o,k)}});var Fe=f(Le,2),ut=S(Fe);{var ct=o=>{var p=nr(),k=h(p),D=S(k);Lt(D,{namespace:"review-description",onError:console.error,styleContext:"chat-input",get initialText(){return l().description},onInput:T=>M(Ce,T,!0),plugins:T=>{Ft(T,{onDrop:rt})},$$slots:{plugins:!0}}),C(k);var ae=f(k,2),R=S(ae);fe(R,{kind:"outline",onclick:Xe,children:(P,T)=>{A();var L=F("Cancel");s(P,L)},$$slots:{default:!0}});var W=f(R,2);Ie(W,{style:"pop",action:Ze,children:(P,T)=>{A();var L=F("Save");s(P,L)},$$slots:{default:!0}}),C(ae),s(o,p)},dt=o=>{var p=O(),k=h(p);{var D=R=>{var W=lr(),P=h(W),T=S(P);qt(T,{get content(){return l().description}}),C(P);var L=f(P,2);{var v=j=>{var m=ir(),V=S(m);fe(V,{kind:"outline",onclick:Te,children:(X,H)=>{A();var mt=F("Change details");s(X,mt)},$$slots:{default:!0}}),C(m),s(j,m)};w(L,j=>{l().permissions.canWrite&&j(v)})}s(R,W)},ae=R=>{var W=cr(),P=f(S(W),2);{var T=L=>{var v=ur(),j=f(h(v),2);fe(j,{icon:"plus-small",kind:"outline",onclick:Te,children:(m,V)=>{A();var X=F("Add summary");s(m,X)},$$slots:{default:!0}}),s(L,v)};w(P,L=>{l().permissions.canWrite&&L(T)})}C(W),s(R,W)};w(k,R=>{l().description?R(D):R(ae,!1)},!0)}s(o,p)};w(ut,o=>{e(de)?o(ct):o(dt,!1)})}C(Fe),C($);var vt=f($,2);Zt(vt,{get branch(){return l()},get data(){return a.data}}),C(J),s(Q,J)},$$slots:{default:!0}})};w(B,i=>{e(Qe)&&e(I)?i(z):i(x,!1)},!0)}s(t,r)};w(at,t=>{e(Se)?t(st):t(ot,!1)})}s(u,Ue),be(),N()}export{Or as component,Vr as universal};
//# sourceMappingURL=7.B0Vv5PZ8.js.map
